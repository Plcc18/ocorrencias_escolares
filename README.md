
# Ocorrências Escolares API

API RESTful para gerenciamento de **ocorrências escolares**, com controle de **alunos**, **professores** e **usuários autenticados** (ADMIN/USER).  
Desenvolvida com **Spring Boot**, **Spring Security**, **JWT**, **PostgreSQL** e **Flyway**.

---

## Funcionalidades

| Módulo       | Funcionalidades |
|--------------|------------------|
| **Usuários** | Cadastro, login com JWT, roles (`ADMIN`, `USER`) |
| **Alunos**   | CRUD completo |
| **Professores** | CRUD completo |
| **Ocorrências** | Registro de ocorrências entre aluno e professor |

> **Apenas a entidade `User` é autenticável.**  
> `Student` e `Teacher` **não possuem login** — são apenas dados cadastrais.

---

## Tecnologias Utilizadas

- **Java 17**
- **Spring Boot 3**
- **Spring Data JPA**
- **Spring Security + JWT**
- **PostgreSQL**
- **Flyway** (migrações de banco)
- **Lombok**
- **ModelMapper**
- **Swagger / OpenAPI**
- **Maven**

---

## Estrutura do Banco de Dados

```sql
users (id, email, username, password, role)
teachers (id, email, name, subject)
students (id, email, name, grade)
occurrences (id, description, occurrence_date, student_id, teacher_id, occurrence_type)
```

> Todas as tabelas possuem restrições `UNIQUE` e `NOT NULL` conforme necessário.

---

## Endpoints Principais

### Autenticação

| Método | Endpoint             | Descrição             | Acesso     |
|--------|----------------------|------------------------|------------|
| POST   | `/api/auth/register` | Cadastra novo usuário  | Público    |
| POST   | `/api/auth/login`    | Login com JWT          | Público    |

#### Exemplo de Registro
POST /api/auth/register
```json
{
  "email": "admin@example.com",
  "username": "admin",
  "password": "123456",
  "role": "ADMIN"
}
```

#### Exemplo de Login
POST /api/auth/login
```json
{
  "email": "admin@example.com",
  "password": "123456"
}
```
→ Retorna: `JWT Token`

---

### Alunos & Professores (Protegidos)

| Método | Endpoint               | Descrição               | Roles Permitidas     |
|--------|------------------------|--------------------------|-----------------------|
| POST   | `/api/students`        | Cria aluno               | `ADMIN`, `USER`       |
| GET    | `/api/students`        | Lista alunos             | `ADMIN`, `USER`       |
| POST   | `/api/teachers`        | Cria professor           | `ADMIN`, `USER`       |
| GET    | `/api/teachers`        | Lista professores        | `ADMIN`, `USER`       |

---

## Como Executar

### Pré-requisitos

- Java 17+
- Maven
- PostgreSQL

### Passos

1. **Clone o repositório**
   ```bash
   git clone https://github.com/Plcc18/ocorrencias_escolares.git
   cd ocorrencias_escolares
   ```

2. **Configure o banco de dados**
   ```bash
   createdb ocorrencias_escolares_api_db
   ```

3. **Configure o `application.properties`**
   ```properties
   spring.datasource.url=jdbc:postgresql://localhost:5432/ocorrencias_escolares_api_db
   spring.datasource.username=seu_usuario
   spring.datasource.password=sua_senha

   spring.flyway.enabled=true
   spring.flyway.baseline-on-migrate=true

   spring.jwt.secret=sua_chave_secreta_aqui
   ```

4. **Execute a aplicação**
   ```bash
   mvn spring-boot:run
   ```

5. **Acesse a API**
   ```
   http://localhost:8080
   ```

6. **Documentação Swagger**
   ```
   http://localhost:8080/swagger-ui.html
   ```

---

## Testes Rápidos (via `curl`)

```bash
# 1. Registrar admin
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","username":"admin","password":"123456","role":"ADMIN"}'

# 2. Fazer login
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"123456"}'

# 3. Criar aluno (com token JWT)
curl -X POST http://localhost:8080/api/students \
  -H "Authorization: Bearer SEU_TOKEN_AQUI" \
  -H "Content-Type: application/json" \
  -d '{"email":"pedro@example.com","name":"Pedro Lucas","grade":"1º Ano"}'
```

---

## Estrutura do Projeto

```
src/
├── main/
│   ├── java/com/example/ocorrencias_escolares_api/
│   │   ├── controller/     → Endpoints REST
│   │   ├── dto/            → DTOs (RegisterRequest, LoginRequest)
│   │   ├── entity/         → Entidades JPA
│   │   ├── repository/     → Repositórios JPA
│   │   ├── service/        → Lógica de negócio
│   │   ├── security/       → JWT, filtros, config
│   │   └── OcorrenciasEscolaresApplication.java
│   └── resources/
│       ├── db/migration/   → V1__create_tables.sql
│       └── application.properties
```

---

## Migração do Banco (Flyway)

O schema é criado automaticamente via Flyway:

```sql
-- db/migration/V1__create_tables.sql
CREATE TABLE users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR(100) UNIQUE NOT NULL,
    username VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(20) NOT NULL
);
-- ... outras tabelas
```

> Execute `mvn flyway:migrate` para aplicar.

---

## Segurança

- **JWT** para autenticação stateless
- **BCrypt** para hash de senhas
- **Roles**: `ROLE_ADMIN`, `ROLE_USER`
- Endpoints `/api/auth/**` são públicos
- Demais endpoints exigem token válido

---

## Contribuição

1. Fork o projeto
2. Crie uma branch: `git checkout -b feature/nova-funcionalidade`
3. Commit: `git commit -m "feat: adiciona X"`
4. Push: `git push origin feature/nova-funcionalidade`
5. Abra um Pull Request

---

## Autor

**Plcc18**  
[GitHub](https://github.com/Plcc18)

---

## Licença

Este projeto está sob a licença MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

---

**Ocorrências Escolares API** — Simples, segura e pronta para produção.